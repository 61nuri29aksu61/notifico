{% extends "base/body.html" %}
{% macro link_p(project) %}
<a href="{{ url_for('projects.overview', u=project.owner.username) }}">
  {{ project.owner.username }}
</a> / <a href="{{ url_for('projects.details', u=project.owner.username, p=project.name) }}">
  {{ project.name }}
</a>
{% endmacro %}

{% block style %}
  {{ super() }}
  <style>
  .metric {
    text-align: center;
  }
  .metric strong {
    display: block;
    font-size: 32px;
    margin-top: 4px;
    margin-bottom: 4px;
  }
  </style>
{% endblock %}

{% block content %}
<div class="container-fluid">
  {% if not g.user %}
  <div class="row-fluid">
    <div class="span12">
      <div class="hero-unit homepage-unit">
        <h1>Notifico</h1>
        <p>Notifico is an open-source (<a href="http://en.wikipedia.org/wiki/MIT_License">MIT</a>) replacement for the now-defunct <a href="http://cia.vc">cia.vc</a> service. Notifico recieves messages (such as commits and issues) from services and scripts and delivers them to IRC channels.</p>
      <p><a class="btn btn-primary btn-large" href="{{ url_for('account.register') }}">Sign Up</a></p>
      <p><small class="muted">Already have an account? <a href="{{ url_for('account.login') }}">Login</a></small></p>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="row-fluid hidden-phone">
    <div class="span3 metric">
      <section>
        <strong>{{ total_messages }}</strong>
        Messages
      </section>
    </div>
    <div class="span3 metric">
      <section>
        <strong>{{ total_projects }}</strong>
        Projects
      </section>
    </div>
    <div class="span3 metric">
      <section>
        <strong>{{ total_users }}</strong>
        Users
      </section>
    </div>
    <div class="span3 metric">
      <section>
        <strong>{{ total_channels }}</strong>
        Channels
      </section>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span12">
      {# Show recently sent messages from public channels. #}
      <section>
        <header>
          <h2>Recent Messages</h2>
        </header>
        <div class="content">
          {% if not recent_messages %}
          {# Nothing to show! #}
          <div class="alert alert-info">
            There haven't been any recent messages.
          </div>
          {% else %}
          <table class="table table-striped table-vertical">
            <tbody>
              {% for message in recent_messages %}
              {% if message.project %}
              <tr>
                <td nowrap>{{ link_p(message.project) }}</td>
                <td style="width: 100%;">
                  {{ message.msg }}
                </td>
              </tr>
              {% endif %}
              {% endfor %}
            </tbody>
          </table>
          {% endif %}
        </div>
      </section>
    </div>
  </div>
</div>
{% endblock %}